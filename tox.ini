[tox]
envlist = 
    legacy_unsupported,
    legacy_incompatible,
    minimum_supported,
    stable_standard,
    latest_optimized
isolated_build = true
requires = tox>=4

[testenv]
basepython = python3.10
skip_install = true
deps =
    # Testing Core
    pytest
    pytest-asyncio>=1.3.0,<1.4.0
    schemathesis>=4.7.8,<4.8.0

    # App Support Libs
    openai>=1.84.0,<2.20.0
    psycopg2-binary>=2.9.9,<3
    alembic==1.17.2
    python-dotenv==1.2.1
    janus==2.0.0
    opentelemetry-api==1.28
    opentelemetry-sdk==1.28
    opentelemetry-exporter-otlp==1.28
    opentelemetry-instrumentation-fastapi==0.49b0

    # [FAIL] Legacy Block: Older versions that lack full support for current code
    legacy_unsupported: fastapi==0.93.0
    legacy_unsupported: SQLAlchemy==1.4.0
    legacy_unsupported: uvicorn==0.15.0

    legacy_incompatible: fastapi==0.95.2
    legacy_incompatible: SQLAlchemy==1.4.0
    legacy_incompatible: uvicorn==0.15.0

    # [PASS] Modern Block: Versions that fully support lifespan and Pydantic v2
    minimum_supported: fastapi==0.100.0
    minimum_supported: SQLAlchemy==1.4.0
    minimum_supported: uvicorn==0.15.0

    stable_standard: fastapi==0.110.0
    stable_standard: SQLAlchemy==2.0.0
    stable_standard: uvicorn==0.30.0

    latest_optimized: -r requirements.txt

commands =
    pip install -e . --no-deps
    python -m pytest tests/unit tests/contract tests/integration
